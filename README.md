# Job Notifier - Telegram Ingestion Service

A production-ready, standalone Python service that automatically fetches job postings from Telegram groups every 5 hours and stores them in a MySQL database.

## Description

This service monitors specified Telegram groups/channels for new messages, extracts job-related content, and stores it in a MySQL database. It runs continuously with a built-in scheduler, requiring no external dependencies or manual intervention.

## Key Features

- **Built-in Scheduler**: Automatically runs every 5 hours without external cron jobs
- **Secure Session Authentication**: Uses pre-generated session strings
- **Standalone Operation**: Fully independent, no Java backend required
- **MySQL Integration**: Direct database insertion with timezone-aware timestamps
- **Robust Logging**: 72-hour log retention with automatic rotation in dedicated Logs folder
- **Error Resilience**: Individual group failures don't crash the service
- **Configurable Groups**: Monitor multiple Telegram groups via environment variables
- **Production Ready**: Designed for 24/7 operation

## Quick Start

### 1. Install Dependencies
```bash
pip install -r requirements.txt
```

### 2. Configure Environment Variables
```bash
# Copy the template
cp .env.example .env

# Edit .env with your actual values
```

### 3. Generate Telegram Session (One-Time Setup)
```bash
# Add your API credentials to .env first
python generate_session.py

# Copy the generated session string to .env
```

### 4. Configure Target Groups
Edit your `.env` file and set the `TELEGRAM_GROUPS` variable:
```
TELEGRAM_GROUPS=Tech Jobs,Python Jobs,Remote Work
```

### 5. Test the Service
```bash
python manual_test.py
```

### 6. Start Production Service
```bash
python scheduler.py
```

The service will now run continuously, fetching messages every 5 hours.

## Configuration

### Environment Variables

| Variable | Description | Required | Example |
|----------|-------------|----------|---------|
| `TELEGRAM_SESSION_STRING` | Pre-generated session for authentication | Yes | Generated by `generate_session.py` |
| `TELEGRAM_GROUPS` | Comma-separated list of groups to monitor | Yes | `"Tech Jobs,Dev Careers"` |
| `DATABASE_URL` | MySQL connection string | Yes | `mysql://user:pass@host:3306/db` |
| `TELEGRAM_API_ID` | API ID from my.telegram.org (setup only) | Setup | `12345678` |
| `TELEGRAM_API_HASH` | API Hash from my.telegram.org (setup only) | Setup | `abcdef123456...` |
| `TELEGRAM_PHONE_NUMBER` | Phone number for initial auth (setup only) | Setup | `+1234567890` |

**Note**: If your password contains special characters like `@`, URL-encode them (e.g., `@` becomes `%40`)

### Database Schema

The service uses a MySQL table named `jobs`:

```sql
CREATE TABLE jobs (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    job VARCHAR(5000),
    timestamp TIMESTAMP,
    processed TINYINT(1) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## File Structure

```
├── scheduler.py        # Main production service with built-in scheduler
├── ingest.py          # Core ingestion logic
├── generate_session.py # One-time session generator
├── manual_test.py     # Testing utility
├── requirements.txt   # Python dependencies
├── .env.example      # Configuration template
├── .gitignore        # Git ignore rules
├── Logs/             # Log files directory (auto-created)
│   ├── ingest.log    # Ingestion service logs
│   └── scheduler.log # Scheduler logs
└── README.md         # This file
```

## Running as a Service

### Linux (systemd)
Create `/etc/systemd/system/telegram-fetcher.service`:
```ini
[Unit]
Description=Telegram Job Fetcher Service
After=network.target mysql.service

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/raw_datafetcher
ExecStart=/usr/bin/python3 /path/to/raw_datafetcher/scheduler.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

Then:
```bash
sudo systemctl daemon-reload
sudo systemctl enable telegram-fetcher
sudo systemctl start telegram-fetcher
```

### Windows (NSSM)
```bash
# Install NSSM (Non-Sucking Service Manager)
nssm install TelegramFetcher "C:\Python\python.exe" "C:\path\to\scheduler.py"
nssm start TelegramFetcher
```

## Security Notes

- Never commit `.env` files or `*.session` files to version control
- The session string provides full account access - keep it secure
- Use the `.env.example` template for sharing configuration structure
- API credentials are only needed once for session generation
- URL-encode special characters in passwords

## Logging

- Logs are stored in the `Logs/` directory
- `ingest.log`: Message fetching and database operations
- `scheduler.log`: Scheduler execution and task status
- Files rotate every 12 hours with 6 files retained (72 hours total)
- Each log entry includes timestamp, level, and detailed message
- No sensitive information is logged

## Monitoring

Check if the service is running:
```bash
# Linux
systemctl status telegram-fetcher

# Windows
sc query TelegramFetcher

# Manual check
tail -f Logs/scheduler.log
```

## Troubleshooting

**Service not fetching messages:**
- Check `Logs/scheduler.log` for errors
- Verify database connection in `.env`
- Ensure Telegram session is valid

**Database connection errors:**
- Verify DATABASE_URL format
- Check if special characters in password are URL-encoded
- Ensure MySQL server is running

**Group not found warnings:**
- Verify exact group names in TELEGRAM_GROUPS
- Check if your account has access to the groups
- Group names are case-sensitive

## Support

For issues or questions, check the log files in the `Logs/` directory for detailed error messages.
